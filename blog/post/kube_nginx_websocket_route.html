<!DOCTYPE html><html lang="en" class="__className_36bd41"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/kube_nginx_websocket_route1.png"/><link rel="stylesheet" href="/_next/static/css/0fa683c6ffcd2b7c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-653a0787c4442713.js"/><script src="/_next/static/chunks/fd9d1056-0395f68b8cc78a20.js" async=""></script><script src="/_next/static/chunks/23-0e308c469b1735ea.js" async=""></script><script src="/_next/static/chunks/main-app-0e27e34dc382070f.js" async=""></script><script src="/_next/static/chunks/231-261bb995fbdfbb4b.js" async=""></script><script src="/_next/static/chunks/173-96223d64304995f5.js" async=""></script><script src="/_next/static/chunks/app/blog/post/%5Bslug%5D/page-f3335040e15dfb25.js" async=""></script><script src="/_next/static/chunks/aa7babf8-0b3459b02fbce46a.js" async=""></script><script src="/_next/static/chunks/8e1d74a4-d5e5f0108d572a08.js" async=""></script><script src="/_next/static/chunks/342-8161a969a7342dcc.js" async=""></script><script src="/_next/static/chunks/app/layout-ab167d93fad18627.js" async=""></script><title>쿠버네티스 Pod 외부접속 with nginx, websocket</title><meta name="description" content="쿠버네티스 nginx로 웹 소켓 외부접속 요청을 다른 pod로 라우팅 시키는 포스팅입니다."/><meta name="keywords" content="kubernetes nginx, kubernetes nodeport, kubernetes 외부접속, nginx sites.conf, kubernetes nodeport extanal, kubernetes clusterip 외부접속, kubernetes clusterip extanal"/><meta property="og:title" content="쿠버네티스 Pod 외부접속 with nginx, websocket"/><meta property="og:description" content="쿠버네티스 nginx로 웹 소켓 외부접속 요청을 다른 pod로 라우팅 시키는 포스팅입니다."/><meta property="og:url" content="https://beenchangseo.github.io/kube_nginx_websocket_route"/><meta property="og:site_name" content="Beenchangseo Blog"/><meta property="og:locale" content="ko_KR"/><meta property="og:type" content="article"/><meta property="article:tag" content="kubernetes nginx"/><meta property="article:tag" content="kubernetes nodeport"/><meta property="article:tag" content="kubernetes 외부접속"/><meta property="article:tag" content="nginx sites.conf"/><meta property="article:tag" content="kubernetes nodeport extanal"/><meta property="article:tag" content="kubernetes clusterip 외부접속"/><meta property="article:tag" content="kubernetes clusterip extanal"/><meta name="twitter:card" content="summary"/><meta name="twitter:creator" content="beenchangseo"/><meta name="twitter:title" content="쿠버네티스 Pod 외부접속 with nginx, websocket"/><meta name="twitter:description" content="쿠버네티스 nginx로 웹 소켓 외부접속 요청을 다른 pod로 라우팅 시키는 포스팅입니다."/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><!--$--><header class="sticky top-0 left-0 w-full z-10 h-20 font-mono transition duration-500 bg-white dark:bg-[#111111]"><div class="max-w-screen-md h-20 flex flex-nowrap items-center justify-between m-auto px-8"><a href="/"><h1 class="font-bold stroke-black dark:stroke-white">BEENCHANGSEO.DEV</h1></a><div class="flex flex-nowrap gap-8 items-center"><button type="button" class="m-0 p-0 sm:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 transition duration-500 stroke-black dark:stroke-white"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button><div class="flex-nowrap items-center justify-center gap-5 text-center hidden sm:flex"><a class="dark:text-white dark:hover:text-green-500 text-center transition duration-250 hover:scale-125 hover:text-green-500" href="/">Home</a><a class="dark:text-white dark:hover:text-green-500 text-center transition duration-250 hover:scale-125 hover:text-green-500" href="/blog">Blog</a><a class="dark:text-white dark:hover:text-green-500 text-center transition duration-250 hover:scale-125 hover:text-green-500" href="/category">Category</a></div></div></div><div class="w-full h-screen absolute top-20 left-0 bg-white flex-col flex-nowrap p-5 flex hidden dark:bg-[#111111]"><a class="dark:text-white dark:hover:text-green-500 text-center transition duration-250 hover:scale-125 hover:text-green-500 text-lg py-4" href="/">Home</a><a class="dark:text-white dark:hover:text-green-500 text-center transition duration-250 hover:scale-125 hover:text-green-500 text-lg py-4" href="/blog">Blog</a><a class="dark:text-white dark:hover:text-green-500 text-center transition duration-250 hover:scale-125 hover:text-green-500 text-lg py-4" href="/category">Category</a></div></header><main class="transition duration-500 bg-white dark:bg-[#111111] text-black dark:text-white"><div class="max-w-screen-md flex flex-col px-10 m-auto"><section><div class="mt-10 pb-10 border-b-2 mb-10 prose dark:prose-invert"><h1 class="mb-8 font-bold text-2xl sm:text-4xl font-mono">쿠버네티스 Pod 외부접속 with nginx, websocket</h1><div class="flex-auto mb-4"><button class="h-8 px-3 m-1 text-xs border-2 border-gray-700 dark:border-gray-300 transition-colors duration-150 rounded-lg cursor-pointer focus:shadow-outline hover:bg-gray-300"><a href="/category?category=other">other</a></button></div><div class="flex items-center justify-between mb-16"><span class="text-sm"><a href="https://beenchangseo.github.io/">beenchangseo</a></span><span class="ml-1 mr-1">·</span><span class="text-sm font-medium text-gray-500">2024년 4월 3일</span><span class="flex items-center ml-auto"><a href="https://hits.seeyoufarm.com"><img alt="Landscape picture" loading="lazy" width="130" height="20" decoding="async" data-nimg="1" class="mb-0 mt-0" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fbeenchangseo.github.io&amp;count_bg=%234B4B4B&amp;title_bg=%23929292&amp;icon=tencentqq.svg&amp;icon_color=%23E7E7E7&amp;title=TODAY&amp;edge_flat=false"/></a></span></div><h1>이 포스팅은 아직 작성 중 입니다. (WIP)</h1>
<h2>쿠버네티스 Pod 외부접속 with nginx, websocket</h2>
<p>로컬 개발 환경을 셋팅하다가, 쿠버네티스에 clusterIP로 설정한 웹 소켓 어플리케이션(pod)들과 host의 express 서버가 서로 통신이 필요한 상황이 왔다.</p>
<p>clusterIP로 설정한 pod는 쿠버네티스의 내부 사설 아이피를 할당 받게된다.</p>
<p>host에서 해당 pod로 접근하려면 NodePort로 변경해야하지만 ClusterIP를 유지하면서 Nginx로 proxy를 해보았다.</p>
<p>그림으로 표현하면 아래와 같다</p>
<p><img src="/images/kube_nginx_websocket_route1.png" alt="kube_nginx_websocket_route1"/></p>
<h2>Service 생성</h2>
<p>서비스는 2개를 생성한다. (NodePort와 ClusterIP)</p>
<p>NodePort는 호스트와 통신하기위한 Nginx pod의 서비스, ClusterIP는 통신의 최종 도착지인 다른 pod 서비스이다.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="yaml" data-theme="github-dark"><code data-language="yaml" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D"># NodePort Service</span></span>
<span data-line=""><span style="color:#85E89D">apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">v1</span></span>
<span data-line=""><span style="color:#85E89D">kind</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Service</span></span>
<span data-line=""><span style="color:#85E89D">metadata</span><span style="color:#E1E4E8">:  </span></span>
<span data-line=""><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">nginx-service</span></span>
<span data-line=""><span style="color:#85E89D">spec</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">  selector</span><span style="color:#E1E4E8">:    </span></span>
<span data-line=""><span style="color:#85E89D">    app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">nginx</span></span>
<span data-line=""><span style="color:#85E89D">  type</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">NodePort</span></span>
<span data-line=""><span style="color:#85E89D">  ports</span><span style="color:#E1E4E8">:  </span></span>
<span data-line=""><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">http</span></span>
<span data-line=""><span style="color:#85E89D">    port</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">80</span></span>
<span data-line=""><span style="color:#85E89D">    targetPort</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">80</span></span>
<span data-line=""><span style="color:#85E89D">    nodePort</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">32088</span><span style="color:#6A737D"> # 호스트와 통신할 외부 포트</span></span>
<span data-line=""><span style="color:#85E89D">    protocol</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">TCP</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="yaml" data-theme="github-dark"><code data-language="yaml" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D"># ClusterIP Service</span></span>
<span data-line=""><span style="color:#85E89D">kind</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Service</span></span>
<span data-line=""><span style="color:#85E89D">apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">v1</span></span>
<span data-line=""><span style="color:#85E89D">metadata</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">  namespace</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">default</span></span>
<span data-line=""><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">my-application-service</span></span>
<span data-line=""><span style="color:#85E89D">spec</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">  selector</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">    app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">my-application</span></span>
<span data-line=""><span style="color:#85E89D">  type</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ClusterIP</span></span>
<span data-line=""><span style="color:#85E89D">  clusterIP</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">None</span></span>
<span data-line=""><span style="color:#85E89D">  ports</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">port</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">32088</span></span>
<span data-line=""><span style="color:#85E89D">    targetPort</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">32088</span></span></code></pre></figure>
<h2>Nginx 설정</h2>
<p>nginx pod를 생성해보자</p>
<p>nginx의 설정 파일(sites.conf, nginx.conf. mime.types)들은 따로 생성하여 볼륨 마운트 시켰다</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="yaml" data-theme="github-dark"><code data-language="yaml" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D"># Nginx Deployment</span></span>
<span data-line=""><span style="color:#85E89D">apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">apps/v1</span></span>
<span data-line=""><span style="color:#85E89D">kind</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Deployment</span></span>
<span data-line=""><span style="color:#85E89D">metadata</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">nginx-deployment</span></span>
<span data-line=""><span style="color:#85E89D">  labels</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">    app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">nginx</span></span>
<span data-line=""><span style="color:#85E89D">spec</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">  replicas</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span></span>
<span data-line=""><span style="color:#85E89D">  selector</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">    matchLabels</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">      app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">nginx</span></span>
<span data-line=""><span style="color:#85E89D">  template</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">    metadata</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">      labels</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">        app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">nginx</span></span>
<span data-line=""><span style="color:#85E89D">    spec</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">      containers</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">nginx</span></span>
<span data-line=""><span style="color:#85E89D">        image</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">nginx:1.14.2</span></span>
<span data-line=""><span style="color:#85E89D">        ports</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#E1E4E8">        - </span><span style="color:#85E89D">containerPort</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">80</span></span>
<span data-line=""><span style="color:#85E89D">        volumeMounts</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#E1E4E8">        - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">config</span></span>
<span data-line=""><span style="color:#85E89D">          mountPath</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">/etc/nginx</span></span>
<span data-line=""><span style="color:#85E89D">      volumes</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">config</span></span>
<span data-line=""><span style="color:#85E89D">        hostPath</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">            path</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">/Users/beenchangseo/deploy/k8s/nginx/config</span></span>
<span data-line=""><span style="color:#85E89D">            type</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Directory</span></span></code></pre></figure>
<h3>sites.conf</h3>
<p>내가 테스트 할 호스트 어플리케이션은 http 서버이고 ClusterIP 서비스에 올려놓은 pod는 websocket 서버이다.</p>
<p>흐름은 아래 구조와 같다</p>
<blockquote>
<p>http server -&gt; nginx -&gt; websocket server pod</p>
</blockquote>
<p>nginx를 웹소켓 proxy로 사용할 수 있도록 아래와 같이 sites.conf를 설정 해준다.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="bash" data-theme="github-dark"><code data-language="bash" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D"># sites.conf</span></span>
<span data-line=""><span style="color:#B392F0">map</span><span style="color:#E1E4E8"> $http_upgrade $connection_upgrade </span><span style="color:#9ECBFF">{</span></span>
<span data-line=""><span style="color:#B392F0">    default</span><span style="color:#9ECBFF"> upgrade</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">    &#x27;&#x27;</span><span style="color:#9ECBFF"> close</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#B392F0">server</span><span style="color:#9ECBFF"> {</span></span>
<span data-line=""><span style="color:#B392F0">	listen</span><span style="color:#79B8FF"> 80</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">	server_name</span><span style="color:#9ECBFF"> marketdata</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#B392F0">	location</span><span style="color:#9ECBFF"> /my-application/ws</span><span style="color:#9ECBFF"> {</span></span>
<span data-line=""><span style="color:#B392F0">        proxy_pass</span><span style="color:#9ECBFF"> http://my-application.default.svc.cluster.local:32088</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">        proxy_http_version</span><span style="color:#79B8FF"> 1.1</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">        proxy_set_header</span><span style="color:#9ECBFF"> Upgrade</span><span style="color:#E1E4E8"> $http_upgrade;</span></span>
<span data-line=""><span style="color:#B392F0">        proxy_set_header</span><span style="color:#9ECBFF"> Connection</span><span style="color:#E1E4E8"> $connection_upgrade;</span></span>
<span data-line=""><span style="color:#E1E4E8">    }</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span></code></pre></figure>
<h3>nginx.conf</h3>
<p>nginx.conf 설정은 log_format만 수정했다.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="bash" data-theme="github-dark"><code data-language="bash" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D"># nginx.conf</span></span>
<span data-line=""><span style="color:#B392F0">user</span><span style="color:#9ECBFF"> nginx</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">worker_processes</span><span style="color:#9ECBFF"> auto</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">worker_cpu_affinity</span><span style="color:#9ECBFF"> auto</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">worker_rlimit_nofile</span><span style="color:#79B8FF"> 65535</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">pid</span><span style="color:#9ECBFF"> /run/nginx.pid</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#B392F0">events</span><span style="color:#9ECBFF"> {</span></span>
<span data-line=""><span style="color:#B392F0">    worker_connections</span><span style="color:#79B8FF"> 1024</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#B392F0">http</span><span style="color:#9ECBFF"> {</span></span>
<span data-line=""><span style="color:#B392F0">    include</span><span style="color:#9ECBFF"> /etc/nginx/mime.types</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#B392F0">    default_type</span><span style="color:#9ECBFF"> application/octet-stream</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#B392F0">    log_format</span><span style="color:#9ECBFF"> compression</span><span style="color:#9ECBFF"> &#x27;$remote_addr - $remote_user [$time_local] &#x27;</span></span>
<span data-line=""><span style="color:#B392F0">                        &#x27;&quot;$request&quot; $status $body_bytes_sent &#x27;</span></span>
<span data-line=""><span style="color:#B392F0">                        &#x27;&quot;$http_referer&quot; &quot;$http_user_agent&quot; &quot;$gzip_ratio&quot;&#x27;</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#B392F0">    access_log</span><span style="color:#9ECBFF"> /var/log/nginx/access.log</span><span style="color:#9ECBFF"> compression</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#E1E4E8">    </span></span>
<span data-line=""><span style="color:#B392F0">    error_log</span><span style="color:#9ECBFF"> /var/log/nginx/error.log</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#B392F0">    include</span><span style="color:#9ECBFF"> ./sites.conf</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span>
<span data-line=""> </span></code></pre></figure>
<h3>mime.types</h3>
<p>mime.types는 대충 인터넷에서 긁어왔다.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="bash" data-theme="github-dark"><code data-language="bash" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D"># mime.types</span></span>
<span data-line=""><span style="color:#B392F0">types</span><span style="color:#9ECBFF"> {</span></span>
<span data-line=""><span style="color:#B392F0">    text/html</span><span style="color:#9ECBFF">                             html</span><span style="color:#9ECBFF"> htm</span><span style="color:#9ECBFF"> shtml</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">    text/css</span><span style="color:#9ECBFF">                              css</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">    text/xml</span><span style="color:#9ECBFF">                              xml</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">    image/gif</span><span style="color:#9ECBFF">                             gif</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">    image/jpeg</span><span style="color:#9ECBFF">                            jpeg</span><span style="color:#9ECBFF"> jpg</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#B392F0">    application/javascript</span><span style="color:#9ECBFF">                js</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#79B8FF">    ...</span></span>
<span data-line=""><span style="color:#79B8FF">    ...</span><span style="color:#9ECBFF"> 중략</span></span>
<span data-line=""><span style="color:#79B8FF">    ...</span></span>
<span data-line=""><span style="color:#B392F0">    video/x-msvideo</span><span style="color:#9ECBFF">                       avi</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span></code></pre></figure>
<h3>nginx pod에 올리기</h3>
<p>쿠버네티스에 nginx pod를 생성한다.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="bash" data-theme="github-dark"><code data-language="bash" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#B392F0">kubectl</span><span style="color:#9ECBFF"> apply</span><span style="color:#79B8FF"> -f</span><span style="color:#9ECBFF"> nginx_service.yaml</span></span>
<span data-line=""><span style="color:#B392F0">kubectl</span><span style="color:#9ECBFF"> apply</span><span style="color:#79B8FF"> -f</span><span style="color:#9ECBFF"> nginx_deployment.yaml</span></span></code></pre></figure>
<p>로그가 잘 나오는지도 확인 해보자</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="bash" data-theme="github-dark"><code data-language="bash" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#B392F0">kubectl</span><span style="color:#9ECBFF"> get</span><span style="color:#9ECBFF"> po</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#9ECBFF"> nginx</span></span>
<span data-line=""><span style="color:#B392F0">NAME</span><span style="color:#9ECBFF">                     READY</span><span style="color:#9ECBFF">     STATUS</span><span style="color:#9ECBFF">    RESTARTS</span><span style="color:#9ECBFF">   AGE</span><span style="color:#9ECBFF">       IP</span><span style="color:#9ECBFF">            NODE</span></span>
<span data-line=""><span style="color:#B392F0">nginx-3800858182-jr4a2</span><span style="color:#79B8FF">   1</span><span style="color:#9ECBFF">/1</span><span style="color:#9ECBFF">       Running</span><span style="color:#79B8FF">   0</span><span style="color:#79B8FF">          13</span><span style="color:#9ECBFF">s</span><span style="color:#9ECBFF">       x.x.x.x</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style="color:#B392F0">kubectl</span><span style="color:#9ECBFF"> logs</span><span style="color:#79B8FF"> -f</span><span style="color:#9ECBFF"> nginx-deployment-xxxxxxxx-xxxxx</span></span>
<span data-line=""><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">21</span><span style="color:#E1E4E8">/4/2024:02:54:45 +0000] - </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">.</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">.</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">.</span><span style="color:#F97583">*</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> *.*.*.*</span><span style="color:#9ECBFF"> -</span><span style="color:#9ECBFF"> &quot;GET / HTTP/1.1&quot;</span><span style="color:#79B8FF"> 200</span><span style="color:#79B8FF"> 6180</span><span style="color:#9ECBFF"> &quot;-&quot;</span><span style="color:#9ECBFF"> &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.182 Safari/537.36&quot;</span></span>
<span data-line=""> </span></code></pre></figure>
<h3>websocket server pod 올리기</h3>
<p>실험용 테스트 웹 소켓 서버 pod를 생성해보자</p>
<p>아래 소스코드를 docker image로 build 후 pod에 올릴 생각이다.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="typescript" data-theme="github-dark"><code data-language="typescript" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#F97583">import</span><span style="color:#79B8FF"> *</span><span style="color:#F97583"> as</span><span style="color:#E1E4E8"> WebSocket </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &#x27;ws&#x27;</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""><span style="color:#F97583">import</span><span style="color:#79B8FF"> *</span><span style="color:#F97583"> as</span><span style="color:#E1E4E8"> express </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &#x27;express&#x27;</span><span style="color:#E1E4E8">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F97583">const</span><span style="color:#79B8FF"> app</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> express</span><span style="color:#E1E4E8">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F97583">const</span><span style="color:#79B8FF"> server</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> app.</span><span style="color:#B392F0">listen</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">32088</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span data-line=""><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#x27;Server is listening on port 32088&#x27;</span><span style="color:#E1E4E8">);</span></span>
<span data-line=""><span style="color:#E1E4E8">});</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F97583">const</span><span style="color:#79B8FF"> wss</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> WebSocket.</span><span style="color:#B392F0">Server</span><span style="color:#E1E4E8">({ server });</span></span></code></pre></figure>
<blockquote>
<p>docker build 과정 생략...</p>
</blockquote>
<p>이미지가 잘 만들어졌다면 이제 웹 소켓 서버를 pod에 올리자</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="yaml" data-theme="github-dark"><code data-language="yaml" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D"># Websocket server deployment</span></span>
<span data-line=""><span style="color:#85E89D">apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">apps/v1</span></span>
<span data-line=""><span style="color:#85E89D">kind</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Deployment</span></span>
<span data-line=""><span style="color:#85E89D">metadata</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">  labels</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">    app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">my-application</span></span>
<span data-line=""><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">my-application</span></span>
<span data-line=""><span style="color:#85E89D">spec</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">  replicas</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span></span>
<span data-line=""><span style="color:#85E89D">  selector</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">    matchLabels</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">      app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">my-application</span></span>
<span data-line=""><span style="color:#85E89D">  template</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">    metadata</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">      labels</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">        app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">my-application</span></span>
<span data-line=""><span style="color:#85E89D">    spec</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#85E89D">      containers</span><span style="color:#E1E4E8">:</span></span>
<span data-line=""><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">image</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">my-application:latest</span></span>
<span data-line=""><span style="color:#85E89D">        imagePullPolicy</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">IfNotPresent</span></span>
<span data-line=""><span style="color:#85E89D">        name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">my-application</span></span>
<span data-line=""><span style="color:#85E89D">        resources</span><span style="color:#E1E4E8">: {}</span></span>
<span data-line=""><span style="color:#85E89D">        terminationMessagePath</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">/dev/termination-log</span></span>
<span data-line=""><span style="color:#85E89D">        terminationMessagePolicy</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">File</span></span>
<span data-line=""><span style="color:#85E89D">      dnsPolicy</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ClusterFirst</span></span>
<span data-line=""><span style="color:#85E89D">status</span><span style="color:#E1E4E8">: {}</span></span></code></pre></figure>
<p>쿠버네티스에 아까 작성해놓은 ClusterIP Service와 websocket server pod를 생성한다.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="bash" data-theme="github-dark"><code data-language="bash" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#B392F0">kubectl</span><span style="color:#9ECBFF"> apply</span><span style="color:#79B8FF"> -f</span><span style="color:#9ECBFF"> clusterip_service.yaml</span></span>
<span data-line=""><span style="color:#B392F0">kubectl</span><span style="color:#9ECBFF"> apply</span><span style="color:#79B8FF"> -f</span><span style="color:#9ECBFF"> my_application_deployment.yaml</span></span></code></pre></figure>
<p>로그가 잘 나오는지도 확인 해보자</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="bash" data-theme="github-dark"><code data-language="bash" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#B392F0">kubectl</span><span style="color:#9ECBFF"> get</span><span style="color:#9ECBFF"> po</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#9ECBFF"> my-application</span></span>
<span data-line=""><span style="color:#B392F0">NAME</span><span style="color:#9ECBFF">                            READY</span><span style="color:#9ECBFF">     STATUS</span><span style="color:#9ECBFF">    RESTARTS</span><span style="color:#9ECBFF">   AGE</span><span style="color:#9ECBFF">       IP</span><span style="color:#9ECBFF">            NODE</span></span>
<span data-line=""><span style="color:#B392F0">my-application-xxxxxxxx-xxxxx</span><span style="color:#79B8FF">   1</span><span style="color:#9ECBFF">/1</span><span style="color:#9ECBFF">       Running</span><span style="color:#79B8FF">   0</span><span style="color:#79B8FF">          13</span><span style="color:#9ECBFF">s</span><span style="color:#9ECBFF">       x.x.x.x</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style="color:#B392F0">kubectl</span><span style="color:#9ECBFF"> logs</span><span style="color:#79B8FF"> -f</span><span style="color:#9ECBFF"> my-application-xxxxxxxx-xxxxx</span></span>
<span data-line=""><span style="color:#B392F0">Server</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> listening</span><span style="color:#9ECBFF"> on</span><span style="color:#9ECBFF"> port</span><span style="color:#79B8FF"> 32088</span></span></code></pre></figure>
<h3>Postman으로 websocket pod에 요청하기</h3>
<h3>nginx, websocket log 결과 확인</h3></div></section></div></main><footer class="w-full font-mono flex flex-col justify-center items-center pt-10 pb-6 transition duration-500 bg-white dark:bg-[#111111] dark:text-white text-black"><div class="flex justify-center gap-4 items-center pt-4 border-t-2 w-36"><a href="beenchangseo@gmail.com" class="hover:scale-110 transition-transform duration-500 hover:text-green-500 hover:fill-green-500 dark:fill-white dark:hover:fill-green-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"></path></svg></a><a href="https://github.com/beenchangseo" class="hover:scale-110 transition-transform duration-500 hover:text-green-500 hover:fill-green-500 dark:fill-white dark:hover:fill-green-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></div><div class="text-sm mt-2">Copyright © 2024 Changbeen seo</div><div class="text-xs mt-2">beenchangseo</div></footer><!--/$--><script src="/_next/static/chunks/webpack-653a0787c4442713.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/a34f9d1faa5f3315-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/0fa683c6ffcd2b7c.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5751,[],\"\"]\n5:I[231,[\"231\",\"static/chunks/231-261bb995fbdfbb4b.js\",\"173\",\"static/chunks/173-96223d64304995f5.js\",\"811\",\"static/chunks/app/blog/post/%5Bslug%5D/page-f3335040e15dfb25.js\"],\"\"]\n6:I[8173,[\"231\",\"static/chunks/231-261bb995fbdfbb4b.js\",\"173\",\"static/chunks/173-96223d64304995f5.js\",\"811\",\"static/chunks/app/blog/post/%5Bslug%5D/page-f3335040e15dfb25.js\"],\"Image\"]\n7:I[9275,[],\"\"]\n9:I[1343,[],\"\"]\na:I[7135,[\"67\",\"static/chunks/aa7babf8-0b3459b02fbce46a.js\",\"699\",\"static/chunks/8e1d74a4-d5e5f0108d572a08.js\",\"231\",\"static/chunks/231-261bb995fbdfbb4b.js\",\"342\",\"static/chunks/342-8161a969a7342dcc.js\",\"185\",\"static/chunks/app/layout-ab167d93fad18627.js\"],\"AuthProvider\"]\nb:I[5957,[\"67\",\"static/chunks/aa7babf8-0b3459b02fbce46a.js\",\"699\",\"static/chunks/8e1d74a4-d5e5f0108d572a08.js\",\"231\",\"static/chunks/231-261bb995fbdfbb4b.js\",\"342\",\"static/chunks/342-8161a969a7342dcc.js\",\"185\",\"static/chunks/app/layout-ab167d93fad18627.js\"],\"default\"]\nc:\"$Sreact.suspense\"\nd:I[4331,[\"67\",\"static/chunks/aa7babf8-0b3459b02fbce46a.js\",\"699\",\"static/chunks/8e1d74a4-d5e5f0108d572a08.js\",\"231\",\"static/chunks/231-261bb995fbdfbb4b.js\",\"342\",\"static/chunks/342-8161a969a7342dcc.js\",\"185\",\"static/chunks/app/layout-ab167d93fad18627.js\"],\"default\"]\nf:I[6130,[],\"\"]\n8:[\"slug\",\"kube_nginx_websocket_route\",\"d\"]\n10:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0fa683c6ffcd2b7c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"GtevJgmrNdmxz8CIx6do6\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/post/kube_nginx_websocket_route\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"kube_nginx_websocket_route\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"kube_nginx_websocket_route\\\"}\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"kube_nginx_websocket_route\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"section\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mt-10 pb-10 border-b-2 mb-10 prose dark:prose-invert\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-8 font-bold text-2xl sm:text-4xl font-mono\",\"children\":\"쿠버네티스 Pod 외부접속 with nginx, websocket\"}],[\"$\",\"div\",null,{\"className\":\"flex-auto mb-4\",\"children\":[[\"$\",\"button\",\"0\",{\"className\":\"h-8 px-3 m-1 text-xs border-2 border-gray-700 dark:border-gray-300 transition-colors duration-150 rounded-lg cursor-pointer focus:shadow-outline hover:bg-gray-300\",\"children\":[\"$\",\"$L5\",null,{\"href\":{\"pathname\":\"/category\",\"query\":{\"category\":\"other\"}},\"children\":\"other\"}]}]]}],[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between mb-16\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-sm\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://beenchangseo.github.io/\",\"children\":\"beenchangseo\"}]}],[\"$\",\"span\",null,{\"className\":\"ml-1 mr-1\",\"children\":\"·\"}],[\"$\",\"span\",null,{\"className\":\"text-sm font-medium text-gray-500\",\"children\":\"2024년 4월 3일\"}],[\"$\",\"span\",null,{\"className\":\"flex items-center ml-auto\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://hits.seeyoufarm.com\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"mb-0 mt-0\",\"src\":\"https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fbeenchangseo.github.io\u0026count_bg=%234B4B4B\u0026title_bg=%23929292\u0026icon=tencentqq.svg\u0026icon_color=%23E7E7E7\u0026title=TODAY\u0026edge_flat=false\",\"alt\":\"Landscape picture\",\"width\":130,\"height\":20}]}]}]]}],[[\"$\",\"h1\",null,{\"children\":\"이 포스팅은 아직 작성 중 입니다. (WIP)\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"쿠버네티스 Pod 외부접속 with nginx, websocket\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"로컬 개발 환경을 셋팅하다가, 쿠버네티스에 clusterIP로 설정한 웹 소켓 어플리케이션(pod)들과 host의 express 서버가 서로 통신이 필요한 상황이 왔다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"clusterIP로 설정한 pod는 쿠버네티스의 내부 사설 아이피를 할당 받게된다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"host에서 해당 pod로 접근하려면 NodePort로 변경해야하지만 ClusterIP를 유지하면서 Nginx로 proxy를 해보았다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"그림으로 표현하면 아래와 같다\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/kube_nginx_websocket_route1.png\",\"alt\":\"kube_nginx_websocket_route1\"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Service 생성\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"서비스는 2개를 생성한다. (NodePort와 ClusterIP)\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"NodePort는 호스트와 통신하기위한 Nginx pod의 서비스, ClusterIP는 통신의 최종 도착지인 다른 pod 서비스이다.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"yaml\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"yaml\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# NodePort Service\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"apiVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"v1\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"kind\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"Service\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"metadata\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":  \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"nginx-service\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"spec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  selector\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":    \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"nginx\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"NodePort\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  ports\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":  \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"  - \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"http\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    port\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"80\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    targetPort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"80\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    nodePort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"32088\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\" # 호스트와 통신할 외부 포트\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    protocol\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"TCP\"}]]}]]}]}]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"yaml\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"yaml\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# ClusterIP Service\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"kind\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"Service\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"apiVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"v1\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"metadata\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  namespace\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"default\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"my-application-service\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"spec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  selector\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"my-application\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"ClusterIP\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  clusterIP\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"None\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  ports\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"  - \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"port\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"32088\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    targetPort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"32088\"}]]}]]}]}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Nginx 설정\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"nginx pod를 생성해보자\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"nginx의 설정 파일(sites.conf, nginx.conf. mime.types)들은 따로 생성하여 볼륨 마운트 시켰다\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"yaml\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"yaml\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# Nginx Deployment\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"apiVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"apps/v1\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"kind\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"Deployment\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"metadata\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"nginx-deployment\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  labels\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"nginx\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"spec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  replicas\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"1\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  selector\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    matchLabels\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"      app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"nginx\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  template\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    metadata\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"      labels\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"nginx\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    spec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"      containers\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"      - \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"nginx\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        image\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"nginx:1.14.2\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        ports\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"        - \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"containerPort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"80\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        volumeMounts\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"        - \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"config\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"          mountPath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"/etc/nginx\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"      volumes\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"      - \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"config\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        hostPath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"            path\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"/Users/beenchangseo/deploy/k8s/nginx/config\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"            type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"Directory\"}]]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"sites.conf\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"내가 테스트 할 호스트 어플리케이션은 http 서버이고 ClusterIP 서비스에 올려놓은 pod는 websocket 서버이다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"흐름은 아래 구조와 같다\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"http server -\u003e nginx -\u003e websocket server pod\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"nginx를 웹소켓 proxy로 사용할 수 있도록 아래와 같이 sites.conf를 설정 해준다.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# sites.conf\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" $http_upgrade $connection_upgrade \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    default\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" upgrade\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    ''\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" close\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"server\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"\\tlisten\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" 80\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"\\tserver_name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" marketdata\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"\\tlocation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" /my-application/ws\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"        proxy_pass\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" http://my-application.default.svc.cluster.local:32088\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"        proxy_http_version\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" 1.1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"        proxy_set_header\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" Upgrade\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" $http_upgrade;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"        proxy_set_header\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" Connection\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" $connection_upgrade;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"nginx.conf\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"nginx.conf 설정은 log_format만 수정했다.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# nginx.conf\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" nginx\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"worker_processes\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" auto\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"worker_cpu_affinity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" auto\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"worker_rlimit_nofile\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" 65535\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"pid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" /run/nginx.pid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"events\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    worker_connections\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" 1024\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"http\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    include\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" /etc/nginx/mime.types\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    default_type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" application/octet-stream\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    log_format\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" compression\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" '$remote_addr - $remote_user [$time_local] '\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"                        '\\\"$request\\\" $status $body_bytes_sent '\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"                        '\\\"$http_referer\\\" \\\"$http_user_agent\\\" \\\"$gzip_ratio\\\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    access_log\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" /var/log/nginx/access.log\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" compression\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    error_log\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" /var/log/nginx/error.log\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    include\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" ./sites.conf\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"mime.types\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"mime.types는 대충 인터넷에서 긁어왔다.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# mime.types\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"types\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    text/html\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"                             html\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" htm\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" shtml\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    text/css\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"                              css\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    text/xml\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"                              xml\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    image/gif\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"                             gif\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    image/jpeg\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"                            jpeg\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" jpg\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    application/javascript\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"                js\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"    ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"    ...\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" 중략\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"    ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    video/x-msvideo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"                       avi\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"nginx pod에 올리기\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"쿠버네티스에 nginx pod를 생성한다.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"kubectl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" apply\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" -f\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" nginx_service.yaml\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"kubectl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" apply\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" -f\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" nginx_deployment.yaml\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"로그가 잘 나오는지도 확인 해보자\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"kubectl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" po\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\" |\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\" grep\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" nginx\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"NAME\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"                     READY\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"     STATUS\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"    RESTARTS\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"   AGE\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"       IP\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"            NODE\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"nginx-3800858182-jr4a2\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"   1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"/1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"       Running\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"   0\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"          13\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"s\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"       x.x.x.x\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"kubectl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" logs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" -f\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" nginx-deployment-xxxxxxxx-xxxxx\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"[\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"21\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"/4/2024:02:54:45 +0000] - \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"*\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"*\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"*\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"*\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\" |\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\" *.*.*.*\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" -\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" \\\"GET / HTTP/1.1\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" 200\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" 6180\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" \\\"-\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" \\\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.182 Safari/537.36\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"websocket server pod 올리기\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"실험용 테스트 웹 소켓 서버 pod를 생성해보자\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"아래 소스코드를 docker image로 build 후 pod에 올릴 생각이다.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"typescript\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"typescript\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" *\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\" as\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" WebSocket \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" 'ws'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" *\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\" as\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" express \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" 'express'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\" express\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" server\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" app.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"listen\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"32088\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\", () \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    console.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"log\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'Server is listening on port 32088'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"});\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" wss\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" WebSocket.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"Server\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"({ server });\"}]]}]]}]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"docker build 과정 생략...\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이미지가 잘 만들어졌다면 이제 웹 소켓 서버를 pod에 올리자\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"yaml\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"yaml\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# Websocket server deployment\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"apiVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"apps/v1\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"kind\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"Deployment\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"metadata\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  labels\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"my-application\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"my-application\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"spec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  replicas\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"1\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  selector\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    matchLabels\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"      app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"my-application\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"  template\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    metadata\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"      labels\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"my-application\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"    spec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"      containers\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\":\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"      - \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"image\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"my-application:latest\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        imagePullPolicy\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"IfNotPresent\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"my-application\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        resources\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": {}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        terminationMessagePath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"/dev/termination-log\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"        terminationMessagePolicy\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"File\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"      dnsPolicy\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"ClusterFirst\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#85E89D\"},\"children\":\"status\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": {}\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"쿠버네티스에 아까 작성해놓은 ClusterIP Service와 websocket server pod를 생성한다.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"kubectl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" apply\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" -f\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" clusterip_service.yaml\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"kubectl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" apply\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" -f\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" my_application_deployment.yaml\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"로그가 잘 나오는지도 확인 해보자\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"kubectl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" po\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\" |\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\" grep\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" my-application\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"NAME\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"                            READY\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"     STATUS\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"    RESTARTS\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"   AGE\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"       IP\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"            NODE\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"my-application-xxxxxxxx-xxxxx\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"   1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"/1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"       Running\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"   0\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"          13\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"s\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"       x.x.x.x\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"kubectl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" logs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" -f\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" my-application-xxxxxxxx-xxxxx\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"Server\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" listening\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" on\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\" port\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\" 32088\"}]]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Postman으로 websocket pod에 요청하기\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"nginx, websocket log 결과 확인\"}]]]}]}]],null],null]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"post\",\"children\",\"$8\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"post\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__className_36bd41\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$La\",null,{\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$c\",null,{\"children\":[[\"$\",\"$Ld\",null,{}],[\"$\",\"main\",null,{\"className\":\"transition duration-500 bg-white dark:bg-[#111111] text-black dark:text-white\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-screen-md flex flex-col px-10 m-auto\",\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}],[\"$\",\"footer\",null,{\"className\":\"w-full font-mono flex flex-col justify-center items-center pt-10 pb-6 transition duration-500 bg-white dark:bg-[#111111] dark:text-white text-black\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center gap-4 items-center pt-4 border-t-2 w-36\",\"children\":[[\"$\",\"a\",null,{\"href\":\"beenchangseo@gmail.com\",\"className\":\"hover:scale-110 transition-transform duration-500 hover:text-green-500 hover:fill-green-500 dark:fill-white dark:hover:fill-green-500\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"24\",\"height\":\"24\",\"viewBox\":\"0 0 24 24\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z\"}]}]}],[\"$\",\"a\",null,{\"href\":\"https://github.com/beenchangseo\",\"className\":\"hover:scale-110 transition-transform duration-500 hover:text-green-500 hover:fill-green-500 dark:fill-white dark:hover:fill-green-500\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"24\",\"height\":\"24\",\"viewBox\":\"0 0 24 24\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\"}]}]}]]}],[\"$\",\"div\",null,{\"className\":\"text-sm mt-2\",\"children\":\"Copyright © 2024 Changbeen seo\"}],[\"$\",\"div\",null,{\"className\":\"text-xs mt-2\",\"children\":\"beenchangseo\"}]]}]]}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Le\"],\"globalErrorComponent\":\"$f\",\"missingSlots\":\"$W10\"}]]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"쿠버네티스 Pod 외부접속 with nginx, websocket\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"쿠버네티스 nginx로 웹 소켓 외부접속 요청을 다른 pod로 라우팅 시키는 포스팅입니다.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"keywords\",\"content\":\"kubernetes nginx, kubernetes nodeport, kubernetes 외부접속, nginx sites.conf, kubernetes nodeport extanal, kubernetes clusterip 외부접속, kubernetes clusterip extanal\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"쿠버네티스 Pod 외부접속 with nginx, websocket\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"쿠버네티스 nginx로 웹 소켓 외부접속 요청을 다른 pod로 라우팅 시키는 포스팅입니다.\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:url\",\"content\":\"https://beenchangseo.github.io/kube_nginx_websocket_route\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:site_name\",\"content\":\"Beenchangseo Blog\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:locale\",\"content\":\"ko_KR\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"11\",{\"property\":\"article:tag\",\"content\":\"kubernetes nginx\"}],[\"$\",\"meta\",\"12\",{\"property\":\"article:tag\",\"content\":\"kubernetes nodeport\"}],[\"$\",\"meta\",\"13\",{\"property\":\"article:tag\",\"content\":\"kubernetes 외부접속\"}],[\"$\",\"meta\",\"14\",{\"property\":\"article:tag\",\"content\":\"nginx sites.conf\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:tag\",\"content\":\"kubernetes nodeport extanal\"}],[\"$\",\"meta\",\"16\",{\"property\":\"article:tag\",\"content\":\"kubernetes clusterip 외부접속\"}],[\"$\",\"meta\",\"17\",{\"property\":\"article:tag\",\"content\":\"kubernetes clusterip extanal\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:creator\",\"content\":\"beenchangseo\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:title\",\"content\":\"쿠버네티스 Pod 외부접속 with nginx, websocket\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:description\",\"content\":\"쿠버네티스 nginx로 웹 소켓 외부접속 요청을 다른 pod로 라우팅 시키는 포스팅입니다.\"}],[\"$\",\"meta\",\"22\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"4:null\n"])</script></body></html>